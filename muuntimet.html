<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK Muuntimet</title>
    <style>
        /* MK Muuntimet, Versio 3.4 - Selkeytetty mobiiliasettelu */
        :root {
            --color-bg: #212529; --color-surface: #343A40; --color-card: #495057; 
            --color-border: #6c757d; --color-text-primary: #F8F9FA; --color-text-secondary: #adb5bd; 
            --color-accent-green: #90EE90; --color-accent-yellow: #FFD700; --color-accent-blue: #0d6efd;
        }
        body {
            background-color: var(--color-bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 20px;
            color: var(--color-text-primary);
        }
        .sisalto-laatikko { max-width: 700px; margin: 30px auto; padding: 10px; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); }
        .teksti-alue { padding: 10px; }
        .header-flex-container { display: flex; align-items: center; justify-content: space-between; gap: 15px; padding-bottom: 10px; }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo { width: 80px; height: 80px; border: 3px solid var(--color-border); border-radius: 50%; }
        .paaotsikko { color: var(--color-accent-green); text-align: left; margin: 0; font-size: 1.8em; font-weight: 300; }
        .huomio-laatikko { background-color: var(--color-card); padding: 20px; border-radius: 12px; margin-top: 20px; text-align: center; border: 1px solid var(--color-border); }
        .valilehdet { display: flex; border-bottom: 1px solid var(--color-border); margin-bottom: 20px; flex-wrap: wrap; }
        .valilehti-nappi { background: none; border: none; color: var(--color-text-secondary); padding: 10px 15px; cursor: pointer; font-size: 0.9em; font-weight: 500; border-bottom: 3px solid transparent; transition: all 0.2s ease; }
        .valilehti-nappi:hover { color: var(--color-text-primary); }
        .valilehti-nappi.aktiivinen { color: var(--color-accent-yellow); border-bottom-color: var(--color-accent-yellow); }
        .valilehti-paneeli { display: none; padding: 10px; }
        .valilehti-paneeli.aktiivinen { display: block; animation: fadein 0.5s; }
        @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
        .muunnin-ryhma { margin-bottom: 25px; }
        .muunnin-ryhma label { display: block; text-align: left; font-size: 0.9em; color: var(--color-text-secondary); margin-bottom: 8px; }
        .muunnin-ryhma input, .muunnin-ryhma select, .muunnin-ryhma textarea {
            width: 100%; box-sizing: border-box; padding: 12px;
            background-color: var(--color-bg); border: 1px solid var(--color-border);
            color: var(--color-text-primary); border-radius: 8px;
            font-family: monospace; font-size: 1em; transition: all 0.2s ease;
        }
        .muunnin-ryhma input:focus, .muunnin-ryhma select:focus, .muunnin-ryhma textarea:focus {
            outline: none; border-color: var(--color-accent-yellow);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-accent-yellow) 25%, transparent);
        }
        .yksikko-muunnin { display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center; }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        .input-wrapper input { padding-right: 40px; }
        .copy-btn { position: absolute; right: 8px; background: none; border: none; color: var(--color-text-secondary); cursor: pointer; font-size: 1.2em; }
        .swap-btn { background: none; border: 1px solid var(--color-border); border-radius: 50%; width: 40px; height: 40px; color: var(--color-text-primary); cursor: pointer; font-size: 1.5em; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .swap-btn:hover { background-color: var(--color-bg); border-color: var(--color-accent-yellow); }
        .tulos-box { background-color: var(--color-bg); padding: 15px; border-radius: 8px; margin-top: 10px; font-size: 1.1em; color: var(--color-accent-yellow); font-weight: bold; }
        #mobile-menu-toggle { display: none; background: none; border: none; cursor: pointer; padding: 8px; z-index: 1001; }
        #mobile-menu-toggle .bar { display: block; width: 25px; height: 3px; margin: 5px auto; background-color: var(--color-text-primary); transition: 0.4s; }
        
        @media screen and (max-width: 800px) {
            body { padding: 5px; }
            .sisalto-laatikko { margin: 10px auto; }
            .paaotsikko { font-size: 1.5em; }
            .logo { width: 60px; height: 60px; }
            #mobile-menu-toggle { display: block; }
            .valilehdet { display: none; flex-direction: column; width: 100%; border-bottom: none; margin-bottom: 10px; }
            .valilehdet.active-menu-class { display: flex; }
            .valilehdet .valilehti-nappi { width: 100%; text-align: left; padding: 12px 15px; border-bottom: 1px solid var(--color-border); }
            .valilehdet .valilehti-nappi.aktiivinen { border-bottom-color: var(--color-accent-yellow); }
            
            /* UUSI MOBIILIasettelu muuntimille */
            .yksikko-muunnin {
                display: grid;
                grid-template-columns: 1fr;
                gap: 15px; /* Lisätään väliä elementtien välille */
            }
            .yksikko-muunnin > * { width: 100%; }
            .yksikko-muunnin .grid-item-arvo   { order: 1; }
            .yksikko-muunnin .grid-item-mista  { order: 2; }
            .yksikko-muunnin .grid-item-swap   { order: 3; transform: rotate(90deg); margin: 0 auto; }
            .yksikko-muunnin .grid-item-mihin  { order: 4; }
            .yksikko-muunnin .grid-item-tulos  { order: 5; margin-top: 10px; }
        }
    </style>
</head>
<body>
    <div class="sisalto-laatikko">
        <div class="teksti-alue">
            <div class="header-flex-container">
                <div class="header-left">
                    <img src="https://img.geocaching.com:443/84454fa6-e23a-4aad-a8a4-612b77f23abe.png" alt="Oma logo" class="logo" />
                    <h3 class="paaotsikko">MK Muuntimet</h3>
                </div>
                 <button id="mobile-menu-toggle">
                    <span class="bar"></span><span class="bar"></span><span class="bar"></span>
                </button>
            </div>

            <div class="huomio-laatikko" style="padding: 0;">
                <div class="valilehdet">
                    <button class="valilehti-nappi aktiivinen" data-valilehti="koordinaatit">Koordinaatit</button>
                    <button class="valilehti-nappi" data-valilehti="paivamaarat">Päivämäärät</button>
                    <button class="valilehti-nappi" data-valilehti="teksti">Teksti</button>
                    <button class="valilehti-nappi" data-valilehti="aika">Aika</button>
                    <button class="valilehti-nappi" data-valilehti="pituus">Pituus</button>
                    <button class="valilehti-nappi" data-valilehti="nopeus">Nopeus</button>
                    <button class="valilehti-nappi" data-valilehti="massa">Massa</button>
                    <button class="valilehti-nappi" data-valilehti="lampotila">Lämpötila</button>
                    <button class="valilehti-nappi" data-valilehti="pinta-ala">Pinta-ala</button>
                    <button class="valilehti-nappi" data-valilehti="tilavuus">Tilavuus</button>
                    <button class="valilehti-nappi" data-valilehti="polttoaine">Polttoaine</button>
                    <button class="valilehti-nappi" data-valilehti="typografia">Typografia</button>
                    <button class="valilehti-nappi" data-valilehti="paine">Paine</button>
                    <button class="valilehti-nappi" data-valilehti="energia">Energia</button>
                    <button class="valilehti-nappi" data-valilehti="teho">Teho</button>
                    <button class="valilehti-nappi" data-valilehti="data">Data</button>
                    <button class="valilehti-nappi" data-valilehti="kulma">Kulma</button>
                    <button class="valilehti-nappi" data-valilehti="roomalaiset">Roomalaiset</button>
                    <button class="valilehti-nappi" data-valilehti="luvut">Lukujärjestelmät</button>
                </div>

                <div class="valilehti-sisalto">
                    <div id="koordinaatit" class="valilehti-paneeli aktiivinen"></div>
                    <div id="paivamaarat" class="valilehti-paneeli"></div>
                    <div id="teksti" class="valilehti-paneeli"></div>
                    <div id="aika" class="valilehti-paneeli"></div>
                    <div id="pituus" class="valilehti-paneeli"></div>
                    <div id="nopeus" class="valilehti-paneeli"></div>
                    <div id="massa" class="valilehti-paneeli"></div>
                    <div id="lampotila" class="valilehti-paneeli"></div>
                    <div id="pinta-ala" class="valilehti-paneeli"></div>
                    <div id="tilavuus" class="valilehti-paneeli"></div>
                    <div id="polttoaine" class="valilehti-paneeli"></div>
                    <div id="typografia" class="valilehti-paneeli"></div>
                    <div id="paine" class="valilehti-paneeli"></div>
                    <div id="energia" class="valilehti-paneeli"></div>
                    <div id="teho" class="valilehti-paneeli"></div>
                    <div id="data" class="valilehti-paneeli"></div>
                    <div id="kulma" class="valilehti-paneeli"></div>
                    <div id="roomalaiset" class="valilehti-paneeli"></div>
                    <div id="luvut" class="valilehti-paneeli"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    /*
      MK MUUNTIMET
      Versio 3.4 - Selkeytetty mobiiliasettelu
    */
    document.addEventListener('DOMContentLoaded', () => {
        // --- PERUSRAKENNE JA NAVIGAATIO ---
        const valilehtiContainer = document.querySelector('.valilehdet');
        const valilehtiPaneelit = document.querySelectorAll('.valilehti-paneeli');
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        
        mobileMenuToggle.addEventListener('click', () => valilehtiContainer.classList.toggle('active-menu-class'));

        const vaihdaValilehtea = (kohde) => {
            valilehtiContainer.querySelectorAll('.valilehti-nappi').forEach(nappi => nappi.classList.toggle('aktiivinen', nappi.dataset.valilehti === kohde));
            valilehtiPaneelit.forEach(paneeli => paneeli.classList.toggle('aktiivinen', paneeli.id === kohde));
        };

        valilehtiContainer.addEventListener('click', (e) => {
            const klikattuNappi = e.target.closest('.valilehti-nappi');
            if (klikattuNappi) {
                vaihdaValilehtea(klikattuNappi.dataset.valilehti);
                if (window.innerWidth <= 800) valilehtiContainer.classList.remove('active-menu-class');
            }
        });
        
        // --- YKSIKKÖMUUNTIMIEN DATA ---
        const yksikot = {
            pituus: [ { sym: 'mm', name: 'Millimetri', kerroin: 0.001 }, { sym: 'cm', name: 'Senttimetri', kerroin: 0.01 }, { sym: 'm', name: 'Metri', kerroin: 1 }, { sym: 'km', name: 'Kilometri', kerroin: 1000 }, { sym: 'in', name: 'Tuuma', kerroin: 0.0254 }, { sym: 'ft', name: 'Jalka', kerroin: 0.3048 }, { sym: 'yd', name: 'Jaardi', kerroin: 0.9144 }, { sym: 'mi', name: 'Maili', kerroin: 1609.34 }, { sym: 'nmi', name: 'Meripeninkulma', kerroin: 1852 }, { sym: 'virsta', name: 'Virsta (Suomi)', kerroin: 1068.8 }, { sym: 'peninkulma', name: 'Peninkulma', kerroin: 10688 } ],
            massa: [ { sym: 'g', name: 'Gramma', kerroin: 1 }, { sym: 'kg', name: 'Kilogramma', kerroin: 1000 }, { sym: 't', name: 'Tonni', kerroin: 1000000 }, { sym: 'oz', name: 'Unssi', kerroin: 28.3495 }, { sym: 'lb', name: 'Naula (pauna)', kerroin: 453.592 }, { sym: 'st', name: 'Stone', kerroin: 6350.29 }, { sym: 'luoti', name: 'Luoti (vanha)', kerroin: 13.28 }, { sym: 'leiviskä', name: 'Leiviskä (vanha)', kerroin: 8500 } ],
            nopeus: [ { sym: 'm/s', name: 'Metriä/s', kerroin: 1 }, { sym: 'km/h', name: 'Kilometriä/h', kerroin: 1 / 3.6 }, { sym: 'mph', name: 'Mailia/h', kerroin: 0.44704 }, { sym: 'kn', name: 'Solmu', kerroin: 0.514444 } ],
            aika: [ { sym: 'ms', name: 'Millisekunti', plural: 'Millisekunteina', kerroin: 0.001 }, { sym: 's', name: 'Sekunti', plural: 'Sekunteina', kerroin: 1 }, { sym: 'min', name: 'Minuutti', plural: 'Minuutteina', kerroin: 60 }, { sym: 'h', name: 'Tunti', plural: 'Tunteina', kerroin: 3600 }, { sym: 'd', name: 'Päivä', plural: 'Päivinä', kerroin: 86400 }, { sym: 'vk', name: 'Viikko', plural: 'Viikkoina', kerroin: 604800 } ],
            pinta_ala: [ { sym: 'mm²', name: 'Neliömillimetri', kerroin: 0.000001 }, { sym: 'cm²', name: 'Neliösenttimetri', kerroin: 0.0001 }, { sym: 'm²', name: 'Neliömetri', kerroin: 1 }, { sym: 'a', name: 'Aari', kerroin: 100 }, { sym: 'ha', name: 'Hehtaari', kerroin: 10000 }, { sym: 'km²', name: 'Neliökilometri', kerroin: 1000000 } ],
            tilavuus: [ { sym: 'ml', name: 'Millilitra', kerroin: 0.001 }, { sym: 'l', name: 'Litra', kerroin: 1 }, { sym: 'm³', name: 'Kuutiometri', kerroin: 1000 }, { sym: 'gal_us', name: 'Gallona (US)', kerroin: 3.78541 }, { sym: 'gal_uk', name: 'Gallona (UK)', kerroin: 4.54609 } ],
            paine: [ { sym: 'Pa', name: 'Pascal', kerroin: 1 }, { sym: 'kPa', name: 'Kilopascal', kerroin: 1000 }, { sym: 'bar', name: 'Baari', kerroin: 100000 }, { sym: 'atm', name: 'Ilmakehä', kerroin: 101325 } ],
            energia: [ { sym: 'J', name: 'Joule', kerroin: 1 }, { sym: 'kJ', name: 'Kilojoule', kerroin: 1000 }, { sym: 'kcal', name: 'Kilokalori', kerroin: 4184 }, { sym: 'kWh', name: 'Kilowattitunti', kerroin: 3600000 } ],
            teho: [ { sym: 'W', name: 'Watti', kerroin: 1 }, { sym: 'kW', name: 'Kilowatti', kerroin: 1000 }, { sym: 'MW', name: 'Megawatti', kerroin: 1000000 }, { sym: 'hp', name: 'Hevosvoima', kerroin: 745.7 } ],
            data: [ { sym: 'B', name: 'Tavu', kerroin: 1 }, { sym: 'KiB', name: 'Kibitavu', kerroin: 1024 }, { sym: 'MiB', name: 'Mebitavu', kerroin: 1024**2 }, { sym: 'GiB', name: 'Gibitavu', kerroin: 1024**3 } ],
            kulma: [ { sym: 'deg', name: 'Aste', kerroin: 1 }, { sym: 'rad', name: 'Radiaani', kerroin: 57.2958 }, { sym: 'grad', name: 'Gooni', kerroin: 0.9 } ],
            typografia: [ { sym: 'px', name: 'Pikseli (px)'}, { sym: 'pt', name: 'Piste (pt)'}, { sym: 'em', name: 'em'}, { sym: 'rem', name: 'rem'} ]
        };
        
        // --- MUUNTIMIEN ALUSTUSFUNKTIOT ---

        const luoVakioMuunninHTML = (id) => `<div class="grid-item-arvo">
                <label for="${id}-arvo">Arvo</label>
                <input type="number" id="${id}-arvo" value="1">
            </div>
            <div class="grid-item-tulos input-wrapper">
                <label for="${id}-tulos">Tulos</label>
                <input type="text" id="${id}-tulos" readonly>
                <button class="copy-btn" title="Kopioi leikepöydälle">📋</button>
            </div>
            <div class="grid-item-mista">
                <label for="${id}-yksikko-mista">Mistä</label>
                <select id="${id}-yksikko-mista"></select>
            </div>
            <button class="swap-btn grid-item-swap" title="Vaihda yksiköt">↔</button>
            <div class="grid-item-mihin">
                <label for="${id}-yksikko-mihin">Mihin</label>
                <select id="${id}-yksikko-mihin"></select>
            </div>`;
        
        const alustaVakioMuunnin = (id, yksikkoData) => {
            const container = document.getElementById(id);
            if (!container) return;
            container.innerHTML = luoVakioMuunninHTML(id);
            const arvoInput = document.getElementById(`${id}-arvo`), tulosInput = document.getElementById(`${id}-tulos`), mistaSelect = document.getElementById(`${id}-yksikko-mista`), mihinSelect = document.getElementById(`${id}-yksikko-mihin`), swapBtn = container.querySelector(`.swap-btn`), copyBtn = container.querySelector(`.copy-btn`);
            yksikkoData.forEach(y => { const teksti = `${y.name} (${y.sym})`; mistaSelect.add(new Option(teksti, y.sym)); mihinSelect.add(new Option(teksti, y.sym)); });
            if(mihinSelect.options.length > 1) mihinSelect.selectedIndex = 1;
            const laske = () => {
                const arvo = parseFloat(arvoInput.value) || 0, mistaKerroin = yksikkoData.find(y => y.sym === mistaSelect.value)?.kerroin || 1, mihinKerroin = yksikkoData.find(y => y.sym === mihinSelect.value)?.kerroin || 1;
                tulosInput.value = (arvo * mistaKerroin / mihinKerroin).toLocaleString('fi-FI', { maximumFractionDigits: 6 });
            };
            swapBtn.addEventListener('click', () => { const temp = mistaSelect.selectedIndex; mistaSelect.selectedIndex = mihinSelect.selectedIndex; mihinSelect.selectedIndex = temp; laske(); });
            copyBtn.addEventListener('click', () => { navigator.clipboard.writeText(tulosInput.value).then(() => { const originalText = copyBtn.textContent; copyBtn.textContent = '✅'; setTimeout(() => copyBtn.textContent = originalText, 1500); }); });
            [arvoInput, mistaSelect, mihinSelect].forEach(el => el.addEventListener('input', laske));
            laske();
        };

        const alustaKoordinaattiMuunnin = () => {
            const container = document.getElementById('koordinaatit');
            container.innerHTML = `<div class="muunnin-ryhma"><label for="dd-input">Desimaaliasteet (DD)</label><input type="text" id="dd-input" placeholder="esim. 60.9814, 25.6601"></div><div class="muunnin-ryhma"><label for="ddm-input">Asteet & Desimaaliminuutit (DDM)</label><input type="text" id="ddm-input" placeholder="esim. N 60° 58.884' E 025° 39.606'"></div><div class="muunnin-ryhma"><label for="dms-input">Asteet, Minuutit & Sekunnit (DMS)</label><input type="text" id="dms-input" placeholder="esim. 60°58'53.0&quot;N 25°39'36.4&quot;E"></div>`;
            const ddInput = document.getElementById('dd-input'), ddmInput = document.getElementById('ddm-input'), dmsInput = document.getElementById('dms-input');
            const paivitaKoordinaatit = (lat, lon, source) => { if (isNaN(lat) || isNaN(lon)) return; if (source !== 'dd') ddInput.value = `${lat.toFixed(6)}, ${lon.toFixed(6)}`; if (source !== 'ddm') ddmInput.value = muotoileDDM(lat, lon); if (source !== 'dms') dmsInput.value = muotoileDMS(lat, lon); };
            const kasittele = (e) => { const coords = parseKoordinaatit(e.target.value); if (coords) paivitaKoordinaatit(coords.lat, coords.lon, e.target.id.split('-')[0]); };
            [ddInput, ddmInput, dmsInput].forEach(input => input.addEventListener('input', kasittele));
            const parseKoordinaatit = (input) => {
                input = input.trim().replace(/,/g, ' ');
                const dmsRegex = /(\d{1,3})[°\s]+(\d{1,2})['\s]+([\d\.]+)"?\s*([ns])[\s,]+(\d{1,3})[°\s]+(\d{1,2})['\s]+([\d\.]+)"?\s*([ew])/i;
                const dmsMatch = input.match(dmsRegex); if (dmsMatch) { let lat = parseFloat(dmsMatch[1]) + parseFloat(dmsMatch[2])/60 + parseFloat(dmsMatch[3])/3600; if(dmsMatch[4].toUpperCase()==='S') lat=-lat; let lon = parseFloat(dmsMatch[5]) + parseFloat(dmsMatch[6])/60 + parseFloat(dmsMatch[7])/3600; if(dmsMatch[8].toUpperCase()==='W') lon=-lon; if(!isNaN(lat)&&!isNaN(lon)) return {lat,lon};}
                const ddmRegex = /([ns])\s*(\d{1,3})[°\s]+([\d.]+)'?[\s,]*([ew])\s*(\d{1,3})[°\s]+([\d.]+)'?/i;
                const ddmMatch = input.match(ddmRegex); if (ddmMatch) { let lat = parseFloat(ddmMatch[2]) + parseFloat(ddmMatch[3])/60; if(ddmMatch[1].toUpperCase()==='S') lat=-lat; let lon = parseFloat(ddmMatch[5]) + parseFloat(ddmMatch[6])/60; if(ddmMatch[4].toUpperCase()==='W') lon=-lon; if(!isNaN(lat)&&!isNaN(lon)) return {lat,lon};}
                const parts = input.split(/\s+/).filter(Boolean); if (parts.length === 2) { const lat = parseFloat(parts[0]), lon = parseFloat(parts[1]); if(!isNaN(lat)&&!isNaN(lon)) return {lat,lon};} return null;
            };
            const muotoileDDM = (lat, lon) => { const f = (v,h1,h2) => `${v>=0?h1:h2} ${Math.floor(Math.abs(v))}° ${((Math.abs(v)-Math.floor(Math.abs(v)))*60).toFixed(3)}'`; return `${f(lat,'N','S')} ${f(lon,'E','W')}`; };
            const muotoileDMS = (lat, lon) => { const f = (v,h1,h2) => { const deg=Math.floor(Math.abs(v)), min=Math.floor((Math.abs(v)-deg)*60), sec=(((Math.abs(v)-deg)*60-min)*60).toFixed(1); return `${deg}°${min}'${sec}"${v>=0?h1:h2}`; }; return `${f(lat,'N','S')} ${f(lon,'E','W')}`; };
        };

        const alustaPaivamaaraLaskuri = () => {
            const container = document.getElementById('paivamaarat');
            container.innerHTML = `<h4>Päivien erotus</h4><div class="muunnin-ryhma"><label for="date-start">Alkupäivä</label><input type="date" id="date-start"></div><div class="muunnin-ryhma"><label for="date-end">Loppupäivä</label><input type="date" id="date-end"></div><div id="date-diff-result" class="tulos-box" style="display: none;"></div><hr style="margin: 30px 0; border-color: var(--color-border);"><h4>Lisää / Vähennä päiviä</h4><div class="muunnin-ryhma"><label for="calc-date-start">Päivämäärä</label><input type="date" id="calc-date-start"></div><div class="muunnin-ryhma"><label for="calc-days">Päivien lukumäärä (+/-)</label><input type="number" id="calc-days" value="100"></div><div id="calc-date-result" class="tulos-box" style="display: none;"></div>`;
            const dateStart = document.getElementById('date-start'), dateEnd = document.getElementById('date-end'), diffResult = document.getElementById('date-diff-result');
            const calcDateStart = document.getElementById('calc-date-start'), calcDays = document.getElementById('calc-days'), calcResult = document.getElementById('calc-date-result');
            const calculateDiff = () => { if(dateStart.value && dateEnd.value) { const start = new Date(dateStart.value), end = new Date(dateEnd.value), difference = Math.round((end - start) / 864e5); diffResult.textContent = `Erotus: ${difference} päivää`; diffResult.style.display = 'block'; }};
            const calculateDate = () => { if(calcDateStart.value && calcDays.value) { const start = new Date(calcDateStart.value), days = parseInt(calcDays.value, 10); start.setDate(start.getDate() + days); calcResult.textContent = `Tulos: ${start.toLocaleDateString('fi-FI')}`; calcResult.style.display = 'block'; }};
            [dateStart, dateEnd].forEach(el => el.addEventListener('input', calculateDiff));
            [calcDateStart, calcDays].forEach(el => el.addEventListener('input', calculateDate));
        };

        const alustaTekstiMuunnin = () => {
            const container = document.getElementById('teksti');
            container.innerHTML = `<div class="muunnin-ryhma"><label for="teksti-tyyppi">Muunnos</label><select id="teksti-tyyppi"><option value="a1z26">A1Z26</option><option value="rot13">ROT13</option><option value="base64">Base64</option><option value="morse">Morse-koodi</option><option value="binary">Teksti ↔ Binääri (ASCII)</option><option value="hex">Teksti ↔ Heksa (ASCII)</option><option value="vigenere">Vigenère-salakirjoitus</option></select></div><div id="vigenere-key-wrapper" class="muunnin-ryhma" style="display:none;"><label for="vigenere-key">Avainsana</label><input type="text" id="vigenere-key"></div><div class="muunnin-ryhma"><label id="teksti-input-label" for="teksti-input">Selkokieli</label><textarea id="teksti-input" rows="4"></textarea></div><div style="text-align: center; margin-bottom: 15px;"><button class="swap-btn" id="teksti-swap" title="Vaihda suunta">↑↓</button></div><div class="muunnin-ryhma"><label id="teksti-output-label" for="teksti-output">Salakieli</label><textarea id="teksti-output" rows="4"></textarea></div>`;
            const elements = { input: document.getElementById('teksti-input'), output: document.getElementById('teksti-output'), type: document.getElementById('teksti-tyyppi'), swap: document.getElementById('teksti-swap'), vigenereWrapper: document.getElementById('vigenere-key-wrapper'), vigenereKey: document.getElementById('vigenere-key'), inputLabel: document.getElementById('teksti-input-label'), outputLabel: document.getElementById('teksti-output-label') };
            const morseMap = {'a':'.-','b':'-...','c':'-.-.','d':'-..','e':'.','f':'..-.','g':'--.','h':'....','i':'..','j':'.---','k':'-.-','l':'.-..','m':'--','n':'-.','o':'---','p':'.--.','q':'--.-','r':'.-.','s':'...','t':'-','u':'..-','v':'...-','w':'.--','x':'-..-','y':'-.--','z':'--..','1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.','0':'-----', ' ':'/'};
            const revMorseMap = Object.fromEntries(Object.entries(morseMap).map(a => a.reverse()));
            const fns = {
                a1z26: { e: s => s.toLowerCase().split('').map(c => (c >= 'a' && c <= 'z') ? c.charCodeAt(0) - 96 : c).join(' '), d: s => s.split(' ').map(n => (n > 0 && n < 27) ? String.fromCharCode(parseInt(n) + 96) : n).join('') },
                rot13: { e: s => s.replace(/[a-zA-Z]/g, c => String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13))) },
                base64: { e: s => btoa(unescape(encodeURIComponent(s))), d: s => { try { return decodeURIComponent(escape(atob(s))); } catch(e) { return "Virheellinen Base64"; }} },
                morse: { e: s => s.toLowerCase().split('').map(c => morseMap[c] || '').join(' '), d: s => s.split(' ').map(c => revMorseMap[c] || '').join('') },
                binary: { e: s => s.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' '), d: s => s.split(' ').map(b => String.fromCharCode(parseInt(b, 2))).join('') },
                hex: { e: s => s.split('').map(c => c.charCodeAt(0).toString(16).padStart(2, '0').toUpperCase()).join(' '), d: s => s.replace(/\s/g, '').split(/(..)/).filter(Boolean).map(h => String.fromCharCode(parseInt(h, 16))).join('') },
                vigenere: { run: (str, key, decode) => { if (!key) return "Avainsana puuttuu."; key = key.toLowerCase().replace(/[^a-z]/g, ''); let keyIndex = 0; let result = ''; for (let i = 0; i < str.length; i++) { const charCode = str.charCodeAt(i); if (charCode >= 65 && charCode <= 90) { const keyShift = key.charCodeAt(keyIndex % key.length) - 97; const shift = decode ? (26 - keyShift) : keyShift; result += String.fromCharCode(((charCode - 65 + shift) % 26) + 65); keyIndex++; } else if (charCode >= 97 && charCode <= 122) { const keyShift = key.charCodeAt(keyIndex % key.length) - 97; const shift = decode ? (26 - keyShift) : keyShift; result += String.fromCharCode(((charCode - 97 + shift) % 26) + 97); keyIndex++; } else { result += str[i]; } } return result; } }
            };
            fns.rot13.d = fns.rot13.e; fns.vigenere.e = (s, k) => fns.vigenere.run(s, k, false); fns.vigenere.d = (s, k) => fns.vigenere.run(s, k, true);
            const muunna = () => { const typeVal = elements.type.value; elements.vigenereWrapper.style.display = typeVal === 'vigenere' ? 'block' : 'none'; const fn = fns[typeVal]; const key = elements.vigenereKey.value; elements.output.value = fn.d(elements.input.value, key); elements.output.value = fn.e(elements.input.value, key); };
            elements.swap.addEventListener('click', () => { [elements.input.value, elements.output.value] = [elements.output.value, elements.input.value]; muunna(); });
            Object.values(elements).forEach(el => el.addEventListener('input', muunna));
            muunna();
        };

        const alustaTypografiaMuunnin = () => {
            const id = 'typografia'; const container = document.getElementById(id);
            container.classList.add('yksikko-muunnin'); // Add class for mobile ordering
            container.innerHTML = `<div class="muunnin-ryhma grid-item-arvo" style="max-width: 200px;"><label for="typo-base">Perusfonttikoko (px)</label><input type="number" id="typo-base" value="16"></div>` + luoVakioMuunninHTML(id).replace('grid-item-arvo','grid-item-typo-arvo'); // Replace to avoid conflict
            const arvoInput = document.getElementById(`${id}-arvo`), tulosInput = document.getElementById(`${id}-tulos`), mistaSelect = document.getElementById(`${id}-yksikko-mista`), mihinSelect = document.getElementById(`${id}-yksikko-mihin`), baseInput = document.getElementById('typo-base'), swapBtn = container.querySelector('.swap-btn'), copyBtn = container.querySelector('.copy-btn');
            yksikot.typografia.forEach(u => { mistaSelect.add(new Option(u.name, u.sym)); mihinSelect.add(new Option(u.name, u.sym)); });
            mihinSelect.selectedIndex = 1;
            // Re-apply grid-item classes for ordering
            baseInput.parentElement.classList.add('grid-item-arvo');
            arvoInput.parentElement.classList.add('grid-item-typo-arvo'); // This now has a unique class
            
            const laske = () => {
                const baseSize = parseFloat(baseInput.value) || 16; let arvo = parseFloat(arvoInput.value) || 0;
                switch (mistaSelect.value) { case 'pt': arvo = arvo * 4 / 3; break; case 'em': case 'rem': arvo = arvo * baseSize; break; }
                let tulos;
                switch (mihinSelect.value) { case 'px': tulos = arvo; break; case 'pt': tulos = arvo * 3 / 4; break; case 'em': case 'rem': tulos = arvo / baseSize; break; default: tulos = arvo; }
                tulosInput.value = tulos.toLocaleString('fi-FI', { maximumFractionDigits: 3 });
            };
            swapBtn.addEventListener('click', () => { const temp = mistaSelect.selectedIndex; mistaSelect.selectedIndex = mihinSelect.selectedIndex; mihinSelect.selectedIndex = temp; laske(); });
            copyBtn.addEventListener('click', () => { navigator.clipboard.writeText(tulosInput.value).then(() => { const originalText = copyBtn.textContent; copyBtn.textContent = '✅'; setTimeout(() => copyBtn.textContent = originalText, 1500); }); });
            [arvoInput, mistaSelect, mihinSelect, baseInput].forEach(el => el.addEventListener('input', laske));
            laske();
        };
        
        const alustaAikaMuunnin = () => {
            const container = document.getElementById('aika');
            container.innerHTML = `<div class="muunnin-ryhma"><label for="aika-arvo">Arvo</label><input type="number" id="aika-arvo" value="1"></div><div class="muunnin-ryhma"><label for="aika-yksikko-mista">Yksikkö</label><select id="aika-yksikko-mista"></select></div><div id="aika-tulokset" class="aika-tulos-laatikko"></div>`;
            const arvoInput = document.getElementById('aika-arvo'), yksikkoSelect = document.getElementById('aika-yksikko-mista'), tuloksetDiv = document.getElementById('aika-tulokset');
            yksikot.aika.forEach(y => yksikkoSelect.add(new Option(`${y.name} (${y.sym})`, y.sym)));
            yksikkoSelect.value = 'h';
            const laske = () => {
                const arvo = parseFloat(arvoInput.value) || 0;
                const mistaKerroin = yksikot.aika.find(y => y.sym === yksikkoSelect.value)?.kerroin || 1;
                const sekunteina = arvo * mistaKerroin;
                let html = '<div class="tulos-box" style="margin-bottom: 15px;"><strong>Yhteensä:</strong> ' + Math.floor(sekunteina/86400) + ' pv, ' + Math.floor((sekunteina%86400)/3600) + ' h, ' + Math.floor((sekunteina%3600)/60) + ' min ja ' + (sekunteina%60).toFixed(1) + ' s</div>';
                yksikot.aika.slice().reverse().forEach(y => { html += `<p><strong>${y.plural || y.name}:</strong> ${(sekunteina / y.kerroin).toLocaleString('fi-FI', { maximumFractionDigits: 4 })} ${y.sym}</p>`; });
                tuloksetDiv.innerHTML = html;
            };
            [arvoInput, yksikkoSelect].forEach(el => el.addEventListener('input', laske));
            laske();
        };

        const alustaLampotilaMuunnin = () => {
            const id = 'lampotila';
            const container = document.getElementById(id);
            container.classList.add('yksikko-muunnin');
            container.innerHTML = luoVakioMuunninHTML(id);
            const arvoInput = document.getElementById('lampotila-arvo'), tulosInput = document.getElementById('lampotila-tulos'), mistaSelect = document.getElementById('lampotila-yksikko-mista'), mihinSelect = document.getElementById('lampotila-yksikko-mihin'), swapBtn = document.querySelector(`#${id} .swap-btn`), copyBtn = document.querySelector(`#${id} .copy-btn`);
            ['Celsius', 'Fahrenheit', 'Kelvin'].forEach(key => { mistaSelect.add(new Option(key, key)); mihinSelect.add(new Option(key, key)); });
            mihinSelect.value = 'Fahrenheit';
            const laske = () => {
                let arvo = parseFloat(arvoInput.value) || 0; let tulos;
                if (mistaSelect.value === 'Fahrenheit') arvo = (arvo - 32) * 5/9;
                else if (mistaSelect.value === 'Kelvin') arvo = arvo - 273.15;
                if (mihinSelect.value === 'Celsius') tulos = arvo;
                else if (mihinSelect.value === 'Fahrenheit') tulos = arvo * 9/5 + 32;
                else if (mihinSelect.value === 'Kelvin') tulos = arvo + 273.15;
                tulosInput.value = tulos.toLocaleString('fi-FI', { maximumFractionDigits: 2 });
            };
            swapBtn.addEventListener('click', () => { const temp = mistaSelect.selectedIndex; mistaSelect.selectedIndex = mihinSelect.selectedIndex; mihinSelect.selectedIndex = temp; laske(); });
            copyBtn.addEventListener('click', () => { navigator.clipboard.writeText(tulosInput.value).then(() => { const originalText = copyBtn.textContent; copyBtn.textContent = '✅'; setTimeout(() => copyBtn.textContent = originalText, 1500); }); });
            [arvoInput, mistaSelect, mihinSelect].forEach(el => el.addEventListener('input', laske));
            laske();
        };

        const alustaPolttoaineMuunnin = () => {
            const id = 'polttoaine';
            const container = document.getElementById(id);
            container.classList.add('yksikko-muunnin');
            container.innerHTML = luoVakioMuunninHTML(id);
            const arvoInput = document.getElementById(`${id}-arvo`), tulosInput = document.getElementById(`${id}-tulos`), mistaSelect = document.getElementById(`${id}-yksikko-mista`), mihinSelect = document.getElementById(`${id}-yksikko-mihin`), swapBtn = document.querySelector(`#${id} .swap-btn`), copyBtn = document.querySelector(`#${id} .copy-btn`);
            const units = [ { sym: 'l100km', name: 'L/100km' }, { sym: 'mpg_us', name: 'MPG (US)' }, { sym: 'mpg_uk', name: 'MPG (UK)' } ];
            units.forEach(u => { mistaSelect.add(new Option(u.name, u.sym)); mihinSelect.add(new Option(u.name, u.sym)); });
            mihinSelect.selectedIndex = 1;
            const laske = () => {
                const arvo = parseFloat(arvoInput.value); if (isNaN(arvo) || arvo === 0) { tulosInput.value = '0'; return; }
                const mista = mistaSelect.value, mihin = mihinSelect.value; let tulos;
                if (mista === mihin) { tulos = arvo; }
                else if (mista === 'l100km') { if (mihin === 'mpg_us') tulos = 235.214 / arvo; else tulos = 282.481 / arvo; }
                else if (mista === 'mpg_us') { if (mihin === 'l100km') tulos = 235.214 / arvo; else tulos = arvo * 1.20095; }
                else { if (mihin === 'l100km') tulos = 282.481 / arvo; else tulos = arvo / 1.20095; }
                tulosInput.value = tulos.toLocaleString('fi-FI', { maximumFractionDigits: 2 });
            };
            swapBtn.addEventListener('click', () => { const temp = mistaSelect.selectedIndex; mistaSelect.selectedIndex = mihinSelect.selectedIndex; mihinSelect.selectedIndex = temp; laske(); });
            copyBtn.addEventListener('click', () => { navigator.clipboard.writeText(tulosInput.value).then(() => { const originalText = copyBtn.textContent; copyBtn.textContent = '✅'; setTimeout(() => copyBtn.textContent = originalText, 1500); }); });
            [arvoInput, mistaSelect, mihinSelect].forEach(el => el.addEventListener('input', laske));
            laske();
        };

        const alustaRoomalainenMuunnin = () => {
            const container = document.getElementById('roomalaiset');
            container.classList.add('yksikko-muunnin');
            container.innerHTML = `<div class="grid-item-arvo"><label for="rooma-arabialainen">Numero</label><input type="number" id="rooma-arabialainen" placeholder="esim. 1984"></div><button class="swap-btn grid-item-swap" id="rooma-swap" title="Vaihda">↔</button><div class="grid-item-tulos"><label for="rooma-roomalainen">Roomalainen numero</label><input type="text" id="rooma-roomalainen" placeholder="esim. MCMLXXXIV"></div>`;
            const arabInput = document.getElementById('rooma-arabialainen'), roomaInput = document.getElementById('rooma-roomalainen');
            const arabToRoman = (num) => { if (isNaN(num) || num < 1 || num > 3999) return ''; const map = { M: 1000, CM: 900, D: 500, CD: 400, C: 100, XC: 90, L: 50, XL: 40, X: 10, IX: 9, V: 5, IV: 4, I: 1 }; let r = ''; for (let k in map) { while (num >= map[k]) { r += k; num -= map[k]; } } return r; };
            const romanToArab = (str) => { str = str.toUpperCase(); const map = { I: 1, V: 5, X: 10, L: 50, C: 100, D: 500, M: 1000 }; let r = 0; for (let i = 0; i < str.length; i++) { const c = map[str[i]], n = map[str[i + 1]]; if (n && c < n) r -= c; else r += c; } return isNaN(r) || r > 3999 ? '' : r; };
            arabInput.addEventListener('input', () => roomaInput.value = arabToRoman(parseInt(arabInput.value, 10)));
            roomaInput.addEventListener('input', () => arabInput.value = romanToArab(roomaInput.value));
        };

        const alustaLukujarjestelmaMuunnin = () => {
            const container = document.getElementById('luvut');
            container.innerHTML = `<div class="muunnin-ryhma"><label for="luku-dec">Desimaali (10)</label><input type="text" id="luku-dec" placeholder="esim. 42"></div><div class="muunnin-ryhma"><label for="luku-bin">Binääri (2)</label><input type="text" id="luku-bin" placeholder="esim. 101010"></div><div class="muunnin-ryhma"><label for="luku-oct">Oktaali (8)</label><input type="text" id="luku-oct" placeholder="esim. 52"></div><div class="muunnin-ryhma"><label for="luku-hex">Heksadesimaali (16)</label><input type="text" id="luku-hex" placeholder="esim. 2A"></div>`;
            const inputs = { dec: 10, bin: 2, oct: 8, hex: 16 };
            Object.keys(inputs).forEach(key => {
                document.getElementById(`luku-${key}`).addEventListener('input', (e) => {
                    const arvo = e.target.value; const pohja = inputs[key];
                    if(arvo === '') { Object.keys(inputs).forEach(otherKey => { document.getElementById(`luku-${otherKey}`).value = ''; }); return; }
                    const desimaaliArvo = parseInt(arvo, pohja);
                    if (isNaN(desimaaliArvo)) return;
                    Object.keys(inputs).forEach(otherKey => { if (key !== otherKey) document.getElementById(`luku-${otherKey}`).value = desimaaliArvo.toString(inputs[otherKey]).toUpperCase(); });
                });
            });
        };

        // --- KAIKKIEN MUUNTIMIEN KÄYNNISTYS ---
        alustaKoordinaattiMuunnin();
        alustaPaivamaaraLaskuri();
        alustaTekstiMuunnin();
        alustaTypografiaMuunnin();
        alustaVakioMuunnin('pituus', yksikot.pituus);
        alustaVakioMuunnin('nopeus', yksikot.nopeus);
        alustaVakioMuunnin('massa', yksikot.massa);
        alustaLampotilaMuunnin();
        alustaVakioMuunnin('pinta-ala', yksikot.pinta_ala);
        alustaVakioMuunnin('tilavuus', yksikot.tilavuus);
        alustaPolttoaineMuunnin();
        alustaVakioMuunnin('paine', yksikot.paine);
        alustaVakioMuunnin('energia', yksikot.energia);
        alustaVakioMuunnin('teho', yksikot.teho);
        alustaVakioMuunnin('data', yksikot.data);
        alustaVakioMuunnin('kulma', yksikot.kulma);
        alustaAikaMuunnin();
        alustaRoomalainenMuunnin();
        alustaLukujarjestelmaMuunnin();
    });
    </script>
</body>
</html>
